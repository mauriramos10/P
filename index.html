<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pantaleón · Supervisión / Modo Administrador</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body{font-family:Arial, sans-serif;background:#f5f7f6;margin:0;padding:20px;}
    h1{color:#c44f11;}
    nav{margin-bottom:20px;}
    button{margin-right:10px;padding:8px 14px;border:none;border-radius:6px;cursor:pointer;background:#f26a21;color:white;}
    table{border-collapse:collapse;width:100%;margin-top:20px;}
    th,td{border:1px solid #ddd;padding:8px;text-align:center;}
    th{background:#c44f11;color:white;}
    tr:nth-child(even){background:#f2f2f2;}
    #adminSection{display:none;}
  </style>
</head>
<body>
  <h1>Pantaleón · Sistema</h1>
  <nav>
    <button onclick="activarAdmin()">Administrador</button>
  </nav>

  <div id="contenido">
    <p>Bienvenido al sistema. Usa el botón Administrador para acceder al modo de supervisión de costos.</p>
  </div>

  <div id="adminSection"></div>

  <script>
    async function cargarCSV(ruta){
      return new Promise((resolve,reject)=>{
        Papa.parse(ruta,{
          download:true,
          header:true,
          dynamicTyping:true,
          complete:(res)=>resolve(res.data),
          error:(err)=>reject(err)
        });
      });
    }

    async function activarAdmin(){
      const clave = prompt("Ingrese la contraseña de administrador:");
      if(clave !== "admin123"){
        alert("Contraseña incorrecta.");
        return;
      }
      mostrarAdmin();
    }

    async function mostrarAdmin(){
      const equipos = await cargarCSV('equipos.csv');
      const costos = await cargarCSV('costos.csv');

      // agrupar costos por equipo
      const gastos = {};
      costos.forEach(c=>{
        if(!gastos[c.No_SAP]) gastos[c.No_SAP] = {total:0,ultimo:""};
        gastos[c.No_SAP].total += c.Costo_Componente;
        gastos[c.No_SAP].ultimo = `${c.Componente} (${c.Costo_Componente} USD – ${c.Fecha})`;
      });

      let html = `<h2>Modo Administrador</h2><table><tr>
        <th>No SAP</th><th>Equipo</th><th>Valor Reemplazo ($)</th>
        <th>Gasto Anual ($)</th><th>%RAV</th><th>Último Componente Cambiado</th>
      </tr>`;

      equipos.forEach(eq=>{
        const g = gastos[eq.No_SAP]||{total:0,ultimo:""};
        const perc = eq.Costo_Equipo? ((g.total/eq.Costo_Equipo)*100).toFixed(1)+"%" : "0%";
        html += `<tr>
          <td>${eq.No_SAP}</td>
          <td>${eq.Equipo}</td>
          <td>${eq.Costo_Equipo}</td>
          <td>${g.total}</td>
          <td>${perc}</td>
          <td>${g.ultimo}</td>
        </tr>`;
      });

      html += "</table>";
      document.getElementById('adminSection').innerHTML = html;
      document.getElementById('adminSection').style.display = "block";
    }
  </script>
</body>
</html>
